<!DOCTYPE html>
<html lang="pt-BR">
<head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista de Colaboradores</title>
    <link rel="icon" href="{% static 'imagens/favicon.ico' %}" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos para o cabe√ßalho fixo da tabela */
        th.sticky {
            position: sticky;
            top: 0;
            background-color: #1f2937;
            color: white;
            z-index: 10;
        }

        /* Estilos personalizados para os bot√µes */
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: #4b5563;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .btn-secondary:hover {
            background-color: #1f2937;
        }

        .btn-success {
            background-color: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-success:hover {
            background-color: #059669;
        }

        .btn-light {
            background-color: #d1d5db;
            color: #1f2937;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-light:hover {
            background-color: #9ca3af;
        }

        /* Estilos para os bot√µes de a√ß√£o na tabela */
        .btn-action-edit {
            background-color: #fcd34d;
            color: #1f2937;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.15s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            font-size: 0.875rem;
        }
        .btn-action-edit:hover {
            background-color: #fbbf24;
        }

        .btn-action-pontos {
            background-color: #3b82f6;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.15s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            font-size: 0.875rem;
        }
        .btn-action-pontos:hover {
            background-color: #2563eb;
        }

        /* Estilos para o Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
        }

        .modal.is-active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 1rem;
            padding: 1.25rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            position: relative;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 1.75rem;
            font-weight: bold;
            position: absolute;
            top: 0.5rem;
            right: 1rem;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Estilos para tabela responsiva */
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Ajustes para telas menores */
        @media (max-width: 1024px) {
            .main-container {
                width: 100%;
                padding: 0.5rem;
            }
            
            .header-container {
                flex-direction: column;
                gap: 1rem;
                padding-bottom: 1rem;
            }
            
            .filter-form {
                grid-template-columns: 1fr !important;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .table-responsive {
                font-size: 0.875rem;
            }
            
            .table-responsive th,
            .table-responsive td {
                padding: 0.5rem 0.25rem;
            }
            
            .status-badge {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }
        }

        @media (max-width: 768px) {
            .btn-primary, .btn-secondary, .btn-success, .btn-light {
                padding: 0.5rem;
                font-size: 0.875rem;
            }
            
            .modal-content {
                margin: 0.5rem;
                padding: 1rem;
            }
        }

        @media (max-width: 640px) {
            .btn-action-edit, .btn-action-pontos {
                padding: 0.2rem 0.4rem;
                font-size: 0.75rem;
            }
            
            .table-responsive th,
            .table-responsive td {
                padding: 0.3rem 0.1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen px-2 pt-4">

    <div class="main-container w-full mx-auto flex flex-col min-h-[90vh] px-2 sm:px-4 md:px-6 lg:px-8"> 

        <div class="header-container flex flex-col sm:flex-row items-start sm:items-center justify-between border-b pb-4 mb-4 sm:mb-6 gap-4">
            <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900">üìã Lista de Colaboradores</h1>
            <div class="flex gap-2 sm:gap-3 w-full sm:w-auto">
                <a href="{% url 'tarefas:cadastrar_colaborador' %}" class="btn-primary flex-1 sm:flex-none text-center">
                    ‚ûï Novo Colaborador
                </a>
                <a href="{% url 'tarefas:home' %}" class="btn-secondary flex-1 sm:flex-none text-center">
                    üè† Voltar
                </a>
            </div>
        </div>

        {% if messages %}
            <div class="mb-4">
                {% for message in messages %}
                    <div class="bg-{{ message.tags }}-100 border-l-4 border-{{ message.tags }}-500 text-{{ message.tags }}-700 p-4 mb-2 rounded shadow-sm" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <form method="get" class="filter-form grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-4 sm:mb-6 bg-white p-4 sm:p-6 rounded-lg shadow-md w-full text-sm sm:text-base">
            <div class="col-span-full lg:col-span-1">
                <label for="id_busca_nome" class="block font-semibold mb-1 text-gray-700">Buscar por Nome</label>
                <input type="text" id="id_busca_nome" name="busca_nome" 
                       value="{{ filtro_busca_nome }}" 
                       placeholder="Digite o nome completo ou parte dele..."
                       class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring focus:ring-blue-200 focus:border-blue-500 text-sm sm:text-base">
            </div>
            <div>
                <label for="id_setor" class="block font-semibold mb-1 text-gray-700">Setor</label>
                <select id="id_setor" name="setor" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring focus:ring-blue-200 focus:border-blue-500 text-sm sm:text-base">
                    <option value="">Todos os setores</option>
                    <option value="almoxarifado" {% if filtro_setor == "almoxarifado" %}selected{% endif %}>Almoxarifado</option>
                    <option value="ambulatorio" {% if filtro_setor == "ambulatorio" %}selected{% endif %}>Ambulat√≥rio</option>
                    <option value="bloco_cirurgico" {% if filtro_setor == "bloco_cirurgico" %}selected{% endif %}>Bloco Cir√∫rgico</option>
                    <option value="ccih" {% if filtro_setor == "ccih" %}selected{% endif %}>CCIH</option>
                    <option value="clinica_cirurgica" {% if filtro_setor == "clinica_cirurgica" %}selected{% endif %}>Cl√≠nica Cir√∫rgica</option>
                    <option value="clinica_ortopedica" {% if filtro_setor == "clinica_ortopedica" %}selected{% endif %}>Cl√≠nica Ortop√©dica</option>
                    <option value="epidemiologia" {% if filtro_setor == "epidemiologia" %}selected{% endif %}>Epidemiologia</option>
                    <option value="farmacia" {% if filtro_setor == "farmacia" %}selected{% endif %}>Farm√°cia</option>
                    <option value="imobilizacao" {% if filtro_setor == "imobilizacao" %}selected{% endif %}>Imobiliza√ß√£o</option>
                    <option value="maternidade" {% if filtro_setor == "maternidade" %}selected{% endif %}>Maternidade</option>
                    <option value="recepcao" {% if filtro_setor == "recepcao" %}selected{% endif %}>Recep√ß√£o</option>
                    <option value="same" {% if filtro_setor == "same" %}selected{% endif %}>SAME</option>
                    <option value="uti" {% if filtro_setor == "uti" %}selected{% endif %}>UTI</option>
                    <option value="dp" {% if filtro_setor == "dp" %}selected{% endif %}>Departamento Pessoal</option>
                    <option value="plantonista" {% if filtro_setor == "plantonista" %}selected{% endif %}>Plantonista</option>
                    <option value="evolucionista" {% if filtro_setor == "evolucionista" %}selected{% endif %}>Evolucionista</option>
                </select>
            </div>
            <div>
                <label for="id_turno" class="block font-semibold mb-1 text-gray-700">Turno</label>
                <select id="id_turno" name="turno" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring focus:ring-blue-200 focus:border-blue-500 text-sm sm:text-base">
                    <option value="">Todos os turnos</option>
                    <option value="manha" {% if filtro_turno == "manha" %}selected{% endif %}>Manh√£</option>
                    <option value="tarde" {% if filtro_turno == "tarde" %}selected{% endif %}>Tarde</option>
                    <option value="noite" {% if filtro_turno == "noite" %}selected{% endif %}>Noite</option>
                    <option value="integral" {% if filtro_turno == "integral" %}selected{% endif %}>Integral</option>
                    <option value="diarista" {% if filtro_turno == "diarista" %}selected{% endif %}>Diarista</option>
                    <option value="segunda" {% if filtro_turno == "segunda" %}selected{% endif %}>Segunda-Feira</option>
                    <option value="terca" {% if filtro_turno == "terca" %}selected{% endif %}>Ter√ßa-Feira</option>
                    <option value="quarta" {% if filtro_turno == "quarta" %}selected{% endif %}>Quarta-Feira</option>
                    <option value="quinta" {% if filtro_turno == "quinta" %}selected{% endif %}>Quinta-Feira</option>
                    <option value="sexta" {% if filtro_turno == "sexta" %}selected{% endif %}>Sexta-Feira</option>
                    <option value="sabado" {% if filtro_turno == "sabado" %}selected{% endif %}>S√°bado</option>
                    <option value="domingo" {% if filtro_turno == "domingo" %}selected{% endif %}>Domingo</option>
                </select>
            </div>
            <div>
                <label for="id_status" class="block font-semibold mb-1 text-gray-700">Status</label>
                <select id="id_status" name="status" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring focus:ring-blue-200 focus:border-blue-500 text-sm sm:text-base">
                    <option value="">Todos os status</option>
                    <option value="ativo" {% if filtro_status == "ativo" %}selected{% endif %}>Ativo</option>
                    <option value="inativo" {% if filtro_status == "inativo" %}selected{% endif %}>Inativo</option>
                    <option value="ferias" {% if filtro_status == "ferias" %}selected{% endif %}>F√©rias</option>
                    <option value="afastado" {% if filtro_status == "afastado" %}selected{% endif %}>Afastado</option>
                    <option value="licencan" {% if filtro_status == "licencan" %}selected{% endif %}>Licen√ßa Nojo</option>
                    <option value="licencag" {% if filtro_status == "licencag" %}selected{% endif %}>Licen√ßa Gala</option>
                    <option value="licencam" {% if filtro_status == "licencam" %}selected{% endif %}>Licen√ßa Maternidade</option>
                    <option value="licencap" {% if filtro_status == "licencap" %}selected{% endif %}>Licen√ßa Paternidade</option>
                    <option value="licencae" {% if filtro_status == "licencae" %}selected{% endif %}>Licen√ßa Eleitoral</option>
                    <option value="licencat" {% if filtro_status == "licencat" %}selected{% endif %}>Licen√ßa de Trato e Interesse Particular</option>
                    <option value="licencaedu" {% if filtro_status == "licencaedu" %}selected{% endif %}>Licen√ßa Estudo</option>
                    <option value="licencapremio" {% if filtro_status == "licencapremio" %}selected{% endif %}>Licen√ßa Pr√™mio</option>
                    <option value="demitido" {% if filtro_status == "demitido" %}selected{% endif %}>Demitido</option>
                    <option value="exonerado" {% if filtro_status == "exonerado" %}selected{% endif %}>Exonerado</option>
                </select>
            </div>
            <div class="flex items-end gap-2 sm:gap-3 lg:col-span-4 action-buttons">
                <div class="grid grid-cols-2 gap-3 w-full">
                    <button type="submit" class="btn-success w-full text-sm sm:text-base">
                        üîç Filtrar
                    </button>
                    <a href="{% url 'tarefas:listar_colaboradores' %}" class="btn-light w-full text-center text-sm sm:text-base">
                        ‚ùå Limpar
                    </a>
                </div>
            </div>
        </form>

        <div class="table-container flex-grow overflow-x-auto bg-white rounded-lg shadow-lg max-h-[65vh] text-sm sm:text-base">
            <table class="table-responsive min-w-full table-auto text-left">
                <thead>
                    <tr class="bg-gray-800 text-white sticky top-0 z-10">
                        <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider">ID</th>
                        <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider">Matr√≠cula</th>
                        <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider">Nome Completo</th>
                        <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider">Fun√ß√£o</th>
                        <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider">Setor</th>
                        <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider">Turno</th> <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider">Celular</th>
                        <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider text-center">Status</th>
                        <th class="px-2 sm:px-4 py-2 font-semibold text-xs sm:text-sm uppercase tracking-wider text-center min-w-[8rem] sm:min-w-[12rem]">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for colaborador in colaboradores %}
                    <tr class="hover:bg-gray-50 transition duration-150 ease-in-out">
                        <td class="px-2 sm:px-4 py-2">{{ colaborador.registro }}</td>
                        <td class="px-2 sm:px-4 py-2">{{ colaborador.matricula }}</td>
                        <td class="px-2 sm:px-4 py-2">{{ colaborador.nome_completo }}</td>
                        <td class="px-2 sm:px-4 py-2">{{ colaborador.funcao }}</td>
                        <td class="px-2 sm:px-4 py-2">{{ colaborador.get_setor_trabalho_display }}</td>
                        <td class="px-2 sm:px-4 py-2">{{ colaborador.get_turno_display }}</td> <td class="px-2 sm:px-4 py-2">{{ colaborador.celular }}</td>
                        <td class="px-2 sm:px-4 py-2 text-center">
                            <span class="status-badge inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                                {% if colaborador.status == 'ativo' %}
                                    bg-green-100 text-green-800
                                {% elif colaborador.status == 'ferias' %}
                                    bg-blue-100 text-blue-800
                                {% elif colaborador.status == 'afastado' %}
                                    bg-orange-100 text-orange-800
                                {% elif colaborador.status == 'licenca' %}
                                    bg-purple-100 text-purple-800
                                {% elif colaborador.status == 'licencan' %}
                                    bg-purple-100 text-purple-800
                                {% elif colaborador.status == 'licencag' %}
                                    bg-purple-100 text-purple-800
                                {% elif colaborador.status == 'licencam' %}
                                    bg-purple-100 text-purple-800
                                {% elif colaborador.status == 'licencae' %}
                                    bg-purple-100 text-purple-800
                                {% elif colaborador.status == 'licencat' %}
                                    bg-purple-100 text-purple-800
                                {% elif colaborador.status == 'licencaedu' %}
                                    bg-purple-100 text-purple-800
                                {% elif colaborador.status == 'licencapremio' %}
                                    bg-purple-100 text-purple-800
                                {% elif colaborador.status == 'demitido' %}
                                    bg-red-200 text-red-900
                                {% elif colaborador.status == 'exonerado' %}
                                    bg-gray-300 text-gray-800
                                {% else %}
                                    bg-red-100 text-red-800
                                {% endif %}">
                                {% if colaborador.status == 'ativo' %}‚úî Ativo
                                {% elif colaborador.status == 'ferias' %}‚òÄÔ∏è F√©rias
                                {% elif colaborador.status == 'afastado' %}‚ö†Ô∏è Afastado
                                {% elif colaborador.status == 'licencan' %}üíê Nojo
                                {% elif colaborador.status == 'licencag' %}üíç Gala
                                {% elif colaborador.status == 'licencam' %}ü§∞ Maternidade
                                {% elif colaborador.status == 'licencap' %}üë∂ Paternidade
                                {% elif colaborador.status == 'licencae' %}üó≥Ô∏è Eleitoral
                                {% elif colaborador.status == 'licencat' %}üìÑ Trato
                                {% elif colaborador.status == 'licencaedu' %}üìö Estudo
                                {% elif colaborador.status == 'licencapremio' %}üíé Pr√™mio
                                {% elif colaborador.status == 'demitido' %}üõë Demitido
                                {% elif colaborador.status == 'exonerado' %}üö™ Exonerado
                                {% else %}‚ùå Inativo
                                {% endif %}
                            </span>
                        </td>
                        <td class="px-2 sm:px-4 py-2 flex flex-wrap sm:flex-nowrap gap-1 sm:gap-2 justify-center items-center min-w-[8rem] sm:min-w-[12rem]">
                            {% if colaborador.registro %}
                                <a href="{% url 'tarefas:editar_colaborador' colaborador.registro %}" class="btn-action-edit">
                                    ‚úèÔ∏è Editar
                                </a>
                                <button type="button" class="btn-action-pontos" onclick="openFolhaPontoModal('{{ colaborador.registro }}')">
                                    üìã Ponto
                                </button>
                            {% else %}
                                <span class="text-gray-500 text-xs">Registro inv√°lido</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center py-4 sm:py-6 text-gray-500 text-sm sm:text-lg">Nenhum colaborador encontrado.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="folhaPontoModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeFolhaPontoModal()">&times;</span>
            <h2 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-gray-900">Gerar Folha de Ponto</h2>
            <p class="mb-3 sm:mb-4 text-gray-700 text-sm sm:text-base">Selecione o m√™s e o ano de refer√™ncia para a folha de ponto.</p>

            <form id="formGerarFolhaPonto" method="POST" action="{% url 'tarefas:gerar_folha_ponto_pdf' %}">
                {% csrf_token %}
                <input type="hidden" name="colaborador_id" id="modalColaboradorId">

                <div class="mb-3 sm:mb-4">
                    <label for="modalMes" class="block text-sm font-medium text-gray-700 mb-1">M√™s:</label>
                    <select id="modalMes" name="mes" required
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="01">Janeiro</option>
                        <option value="02">Fevereiro</option>
                        <option value="03">Mar√ßo</option>
                        <option value="04">Abril</option>
                        <option value="05">Maio</option>
                        <option value="06">Junho</option>
                        <option value="07">Julho</option>
                        <option value="08">Agosto</option>
                        <option value="09">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>

                <div class="mb-4 sm:mb-6">
                    <label for="modalAno" class="block text-sm font-medium text-gray-700 mb-1">Ano:</label>
                    <select id="modalAno" name="ano" required
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        {# Anos ser√£o preenchidos via JS #}
                    </select>
                </div>

                <div class="flex justify-end gap-2 sm:gap-3">
                    <button type="button" onclick="closeFolhaPontoModal()" class="btn-secondary text-sm sm:text-base">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-primary text-sm sm:text-base">
                        Gerar PDF
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Fun√ß√£o para preencher os anos no dropdown do modal
        document.addEventListener('DOMContentLoaded', function() {
            const anoSelect = document.getElementById('modalAno');
            const currentYear = new Date().getFullYear();
            // Gera anos, por exemplo, de 10 anos atr√°s at√© 5 anos no futuro
            for (let i = currentYear - 10; i <= currentYear + 5; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                if (i === currentYear) {
                    option.selected = true; // Seleciona o ano atual por padr√£o
                }
                anoSelect.appendChild(option);
            }

            // Define o m√™s atual como padr√£o no modal ao carregar a p√°gina
            const monthSelect = document.getElementById('modalMes');
            const currentMonth = (new Date().getMonth() + 1).toString().padStart(2, '0');
            monthSelect.value = currentMonth;
        });

        // Fun√ß√£o para abrir o modal
        function openFolhaPontoModal(colaboradorId) {
            document.getElementById('modalColaboradorId').value = colaboradorId;
            document.getElementById('folhaPontoModal').classList.add('is-active');
        }

        // Fun√ß√£o para fechar o modal
        function closeFolhaPontoModal() {
            document.getElementById('folhaPontoModal').classList.remove('is-active');
        }

        // Fecha o modal se o usu√°rio clicar fora do conte√∫do do modal
        window.onclick = function(event) {
            const modal = document.getElementById('folhaPontoModal');
            if (event.target == modal) {
                closeFolhaPontoModal();
            }
        }
    </script>
</body>
</html>